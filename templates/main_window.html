<!-- prettier-ignore -->
<div id="main_window" class="system-window">
  <div id="status_container">
    <div id="settings_icon">
      <img src="{{ url_for('static', filename='images/icons/settings.png') }}" alt="Settings" />
    </div>
    <h1 id="name"></h1>

    <div id="level_coin_container">
      <div id="level_container">
        <h1></h1>
        <h2>Level</h2>
      </div>
      <div id="coin_container">
        <h1></h1>
        <h2>Coins</h2>
      </div>
    </div>

    <div id="progress_container">
      <div id="progress_bar"></div>
    </div>
    <div id="progress_texts">
      <span id="current_xp"></span>
      <span id="xp_label">XP</span>
      <span id="xp_needed">20</span>
    </div>
  </div>

  <ul id="selection_list">
    <li class="active">Tasks</li>
    <li>Consequences</li>
  </ul>

  <div id="tasks_container"></div>
  <div id="consequences_container"></div>

  <button id="add_task_btn" onclick="switch_window('add_task_window')">+</button>
  <button id="add_consequence_btn" onclick="switch_window('add_consequence_window')">+</button>
</div>
<!-- prettier-ignore -->

<script type="module">
  import {
    switch_to_main_window,
    show_window,
  } from "{{ url_for('static', filename='js/system_windows.js') }}";

  function load_user_data(level, xp, coins, xpNeeded, user_name) {
    console.log("Loading user data...");
    if (user_name == "none") {
      user_data = false;
      return;
    }

    document.getElementById("level_container").querySelector("h1").innerHTML =
      level;

    document.getElementById("coin_container").querySelector("h1").innerHTML =
      coins;

    document.getElementById("xp_needed").innerHTML = xpNeeded;

    document.getElementById("current_xp").innerHTML = xp;

    // set xp
    const progressBar = document.getElementById("progress_bar");
    const progressPercent = (amount / nextLevelXP) * 100;
    progressBar.style.width = `${progressPercent}%`;

    document.getElementById("name").innerHTML = user_name;
  }

  document.addEventListener("DOMContentLoaded", () => {
    load_user_data(
      currentLevel,
      currentXP,
      current_coins,
      nextLevelXP,
      user_name
    );
  });

  document.addEventListener(
    "click",
    () => {
      document.getElementById("activate_msg").style.display = "none";
      if (user_data) {
        switch_to_main_window();
      } else {
        show_window("add_user_window");
      }
    },
    { once: true }
  );
</script>
